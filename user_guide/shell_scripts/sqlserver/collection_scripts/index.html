<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../../oracle/collection_masker/ rel=prev><link href=../db_user_create/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.9"><title>Data Collection - Database Migration Assessment</title><link rel=stylesheet href=../../../../assets/stylesheets/main.4af4bdda.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../assets/_mkdocstrings.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#google-cloud-database-migration-assessment-for-microsoft-sql-server class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title="Database Migration Assessment" class="md-header__button md-logo" aria-label="Database Migration Assessment" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Database Migration Assessment </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Data Collection </span> </div> </div> </div> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/GoogleCloudPlatform/database-assessment title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title="Database Migration Assessment" class="md-nav__button md-logo" aria-label="Database Migration Assessment" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Database Migration Assessment </label> <div class=md-nav__source> <a href=https://github.com/GoogleCloudPlatform/database-assessment title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Oracle Data Collection </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Oracle Data Collection </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../oracle/collection_scripts/ class=md-nav__link> <span class=md-ellipsis> Data Collection </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/permissions/ class=md-nav__link> <span class=md-ellipsis> Permissions Required </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/db_user_create/ class=md-nav__link> <span class=md-ellipsis> Database User Scripts </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/collection_masker/ class=md-nav__link> <span class=md-ellipsis> Collection Masking </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Microsoft SQL Server Data Collection </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Microsoft SQL Server Data Collection </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Data Collection </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Data Collection </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#license-requirements class=md-nav__link> <span class=md-ellipsis> License Requirements </span> </a> </li> <li class=md-nav__item> <a href=#database-privileges class=md-nav__link> <span class=md-ellipsis> Database Privileges </span> </a> </li> <li class=md-nav__item> <a href=#system-requirements class=md-nav__link> <span class=md-ellipsis> System Requirements </span> </a> </li> <li class=md-nav__item> <a href=#preparation class=md-nav__link> <span class=md-ellipsis> Preparation </span> </a> </li> <li class=md-nav__item> <a href=#execution class=md-nav__link> <span class=md-ellipsis> Execution </span> </a> <nav class=md-nav aria-label=Execution> <ul class=md-nav__list> <li class=md-nav__item> <a href=#perfmon-requirements-optional class=md-nav__link> <span class=md-ellipsis> Perfmon Requirements (Optional) </span> </a> </li> <li class=md-nav__item> <a href=#perform-collection class=md-nav__link> <span class=md-ellipsis> Perform Collection </span> </a> <nav class=md-nav aria-label="Perform Collection"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#collectvmspecs class=md-nav__link> <span class=md-ellipsis> CollectVMSpecs: </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#return-results class=md-nav__link> <span class=md-ellipsis> Return Results </span> </a> </li> <li class=md-nav__item> <a href=#digitially-signing-powershell-scripts-optional-only-if-necessary class=md-nav__link> <span class=md-ellipsis> Digitially Signing Powershell Scripts (Optional / Only if Necessary) </span> </a> </li> <li class=md-nav__item> <a href=#license class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../db_user_create/ class=md-nav__link> <span class=md-ellipsis> Database User Scripts </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Postgres Data Collection </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Postgres Data Collection </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../postgres/collection_scripts/ class=md-nav__link> <span class=md-ellipsis> Data Collection </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> MySQL Data Collection </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> MySQL Data Collection </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mysql/collection_scripts/ class=md-nav__link> <span class=md-ellipsis> Data Collection </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Developers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Developers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../developer_guide/developer_setup/ class=md-nav__link> <span class=md-ellipsis> Developer Setup </span> </a> </li> <li class=md-nav__item> <a href=../../../../developer_guide/commands/ class=md-nav__link> <span class=md-ellipsis> Commands </span> </a> </li> <li class=md-nav__item> <a href=../../../../developer_guide/workflows/ class=md-nav__link> <span class=md-ellipsis> Workflows </span> </a> </li> <li class=md-nav__item> <a href=../../../../developer_guide/releases/ class=md-nav__link> <span class=md-ellipsis> Releases </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../code_of_conduct/ class=md-nav__link> <span class=md-ellipsis> Code Of Conduct </span> </a> </li> <li class=md-nav__item> <a href=../../../../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#license-requirements class=md-nav__link> <span class=md-ellipsis> License Requirements </span> </a> </li> <li class=md-nav__item> <a href=#database-privileges class=md-nav__link> <span class=md-ellipsis> Database Privileges </span> </a> </li> <li class=md-nav__item> <a href=#system-requirements class=md-nav__link> <span class=md-ellipsis> System Requirements </span> </a> </li> <li class=md-nav__item> <a href=#preparation class=md-nav__link> <span class=md-ellipsis> Preparation </span> </a> </li> <li class=md-nav__item> <a href=#execution class=md-nav__link> <span class=md-ellipsis> Execution </span> </a> <nav class=md-nav aria-label=Execution> <ul class=md-nav__list> <li class=md-nav__item> <a href=#perfmon-requirements-optional class=md-nav__link> <span class=md-ellipsis> Perfmon Requirements (Optional) </span> </a> </li> <li class=md-nav__item> <a href=#perform-collection class=md-nav__link> <span class=md-ellipsis> Perform Collection </span> </a> <nav class=md-nav aria-label="Perform Collection"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#collectvmspecs class=md-nav__link> <span class=md-ellipsis> CollectVMSpecs: </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#return-results class=md-nav__link> <span class=md-ellipsis> Return Results </span> </a> </li> <li class=md-nav__item> <a href=#digitially-signing-powershell-scripts-optional-only-if-necessary class=md-nav__link> <span class=md-ellipsis> Digitially Signing Powershell Scripts (Optional / Only if Necessary) </span> </a> </li> <li class=md-nav__item> <a href=#license class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=google-cloud-database-migration-assessment-for-microsoft-sql-server>Google Cloud Database Migration Assessment for Microsoft SQL Server</h1> <p>Instructions on how to prepare and run Google Database Migration Assessment Data Extractor for Microsoft SQL Server to extract the data required for analysis by the Database Migration Assessment tool.</p> <p>These scripts have been tested with the following platforms:</p> <p>SQL Server Versions:</p> <ul> <li>SQL Server 2008 (SP4-GDR) (KB5020863) - 10.0.6814.4 (X64) through SQL Server 2022</li> <li>AZURE SQL Database</li> </ul> <p>Operating System Versions:</p> <ul> <li>Windows Server 2012 through Windows Server 2022 (Requires PowerShell Version 5 or Greater)</li> </ul> <hr> <h2 id=introduction>Introduction</h2> <p>This utility extracts metadata about the tables, partitions and SQL workload in a database into CSV files. It also leverages perfmon data that must have a perfmon counter started before the final data collection. These CSV files are then used by Database Migration Assessment internally to analyze the data with Google Database Migration Assessment.</p> <hr> <h2 id=license-requirements>License Requirements</h2> <p>!!! IMPORTANT Google Database Migration Assessment does not require any additional licensing with regards to Microsoft SQL Server.</p> <hr> <h2 id=database-privileges>Database Privileges</h2> <p>This utility must be run as a database user with privileges to SELECT from certain data dictionary views. The scripts "createUserForAssessmentWithSQLAuth.bat" and "createUserForAssessmentWithWindowsAuth.bat" are supplied to create the required user and privileges. Instructions for executing it are below. Alternatively, you may use a user that already has following privileges:</p> <p>In the master database:</p> <pre><code class=language-sql>  GRANT VIEW SERVER STATE TO [username];
  GRANT SELECT ALL USER SECURABLES TO [username];
  GRANT VIEW ANY DATABASE TO [username];
  GRANT VIEW ANY DEFINITION TO [username];
  GRANT VIEW SERVER STATE TO [username];
  GRANT VIEW DATABASE STATE TO [username];
</code></pre> <p>In addition the user must also be mapped to all user databases, tempdb and master databases along with the following grant:</p> <pre><code class=language-sql>  use [user database name];
  CREATE USER [username] FOR LOGIN [username];
  GRANT VIEW DATABASE STATE TO [username];
</code></pre> <hr> <h2 id=system-requirements>System Requirements</h2> <p>The collection script depends on the following executables to be available on the machine from which it is run. The script is also expected to be run from a Windows machine in "Administrator Mode":</p> <pre><code class=language-shell>command prompt
powershell (version 5 or greater)
sqlcmd (version 11.0.7512.11 or greater)
</code></pre> <p>If needed sqlcmd can be downloaded from <a href="https://learn.microsoft.com/en-us/sql/tools/sqlcmd/sqlcmd-utility?view=sql-server-ver16&tabs=odbc%2Cwindows#download-and-install-sqlcmd">here</a></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Ensure that the <code>ODBC</code> version of <code>sqlcmd</code> is used Ensure that <code>sqlcmd</code> is also in your <code>$PATH</code> variable</p> </div> <hr> <h2 id=preparation>Preparation</h2> <p>In order to begin running the Database Migration Assessment Collection process, download the collector script from <a href=https://github.com/GoogleCloudPlatform/database-assessment/releases/latest/download/db-migration-assessment-collection-scripts-sqlserver.zip>here</a> onto the host to be collected and follow the below instructions:</p> <p><br></p> <pre><code>- Alternative download instructions:
    mkdir ./dbma_collector &amp;&amp; cd dbma_collector
    wget https://github.com/GoogleCloudPlatform/database-assessment/releases/latest/download/db-migration-assessment-collection-scripts-sqlserver.zip

- Unzip the install archive:
    unzip db-migration-assessment-collection-scripts-sqlserver.zip

- An existing user may be used or one can be created using the scripts as shown below.  SYSADMIN is not required although a user with that privilege may be used:

    If an existing user with SYSADMIN privileges wil not be used, from a command prompt, execute either of the following scripts depending on what type of authentication you currently use for your SYSADMIN user.

    In this example the collection user will use SQL Authentication:
        - createUserForAssessmentWithSQLAuth.bat
            The following parameters can be specified:
                -serverName  ** Required
                -port  ** Optional (Defaults to 1433)
                -serverUserName  ** Required
                -serverUserPass  ** Required
                -collectionUserName  ** Required
                -collectionUserPass  ** Optional (If not provided will be prompted)

        For a Named Instance:
            createUserForAssessmentWithSQLAuth.bat -serverName [servername\instanceName] -port [port number] -serverUserName [existing privileged user] -serverUserPass [privileged user password] -collectionUserName [collection user name] -collectionUserPass [collection user password]

        For a Default Instance:
            createUserForAssessmentWithSQLAuth.bat -serverName [servername] -port [port number] -collectionUserName [collection user name] -collectionUserPass [collection user password]

    In this example, the created user will use Windows Authentication:
        - createUserForAssessmentWithWindowsAuth.bat
            The following parameters can be specified:
                -serverName  ** Required
                -port  ** Optional (Defaults to 1433)
                -collectionUserName  ** Required
                -collectionUserPass  ** Optional (If not provided will be prompted)

        For a Named Instance:
            createUserForAssessmentWithWindowsAuth.bat -serverName [servername\instanceName] -port [port number] -collectionUserName [collection user name] -collectionUserPass [collection user password]

        For a Default Instance:
            createUserForAssessmentWithWindowsAuth.bat -serverName [servername] -port [port number] -collectionUserName [collection user name] -collectionUserPass [collection user password]
</code></pre> <hr> <h2 id=execution>Execution</h2> <h4 id=perfmon-requirements-optional>Perfmon Requirements (Optional)</h4> <ul> <li>NOTE: Executing Perfmon is OPTIONAL. If not executed the tool will evaluate complexity of migration, but not rightsizing requirements.</li> <li> <p>NOTE: The standard perfmon collector collects every 10 minutes for 8 days.</p> </li> <li> <p>If you have your own perfmon counters capturing the following statistics or run on a SQL Server Product such as Amazon RDS or Google CloudSQL for SQL Server, skip to step b, otherwise proceed to step a. ** The Perfmon data collection process is optional and can be safely skipped. However, there will be no right sizing information in the assessment report. <br></p> <pre><code>    \Memory\Available MBytes
        total amount of available memory on the system
    \PhysicalDisk(_Total)\Avg. Disk Bytes/Read
        shows the average size of read operations on a volume in bytes
    \PhysicalDisk(_Total)\Avg. Disk Bytes/Write
        shows the average size of write operations on a volume in bytes
    \PhysicalDisk(_Total)\Avg. Disk sec/Read
        displays the average time in seconds it takes to read data from a disk
    \PhysicalDisk(_Total)\Avg. Disk sec/Write
        displays the average time in seconds it takes to write data to a disk
    \PhysicalDisk(_Total)\Disk Reads/sec
        displays the read IOPS from a file per second (if file is in file cache this counter is not incremented)
    \PhysicalDisk(_Total)\Disk Writes/sec
        displays the write IOPS to a file per second (if file is in file cache this counter is not incremented)
    \Processor(_Total)\% Idle Time
        the percentage of time a processor spends on idle threads
    \Processor(_Total)\% Processor Time
        displays the percentage of time a processor spends executing non-idle threads
    \Processor Information(_Total)\Processor Frequency
        processor frequency
    \System\Processor Queue Length
        number of threads that are ready to execute but waiting for a core to become available
    \SQLServer:Buffer Manager\Buffer cache hit ratio
        this ratio is a measure of the percentage of pages that were found in memory (SQL buffer pool) without having to be read from disk.
    \SQLServer:Buffer Manager\Checkpoint pages/sec
        the number of dirty pages that are moved from the SQL buffer pool to disk during a checkpoint.
    \SQLServer:Buffer Manager\Free list stalls/sec
        how many requests per second are waiting for a free page (values above 2 means server needs more memory)
    \SQLServer:Buffer Manager\Page life expectancy
        indicates the memory pressure in allocated memory to the SQL Server instance
    \SQLServer:Buffer Manager\Page lookups/sec
        number of requests to find a page in the buffer pool
    \SQLServer:Buffer Manager\Page reads/sec
        rate at which the disk is read to resolve page faults (pages read into memory)
    \SQLServer:Buffer Manager\Page writes/sec
        rate at which page data is written to the disk to open up space in physical memory
    \SQLServer:General Statistics\User Connections
        number of current connections to SQL Server.
    \SQLServer:Memory Manager\Memory Grants Pending
        total number of SQL Server processes that are waiting for workspace memory to be granted (Should nearly always be zero)
    \SQLServer:Memory Manager\Target Server Memory (KB)
        the amount of memory that SQL Server can potentially consume
    \SQLServer:Memory Manager\Total Server Memory (KB)
        the amount of memory the server has committed using the memory manager
    \SQLServer:SQL Statistics\Batch Requests/sec
        number of T-SQL commands that are being received by the server per second
    \NUMA Node Memory(_Total)\Total MBytes
        represents the total amount of physical memory associated with a NUMA node in megabytes
    \NUMA Node Memory(_Total)\Available MBytes
        represents the free amount of physical memory associated with a NUMA node in megabytes
    \Process(_Total)\IO Read Operations/sec
        shows the rate at which a process issues read I/O operations. This counter includes all I/O activity generated by the process, including file, network, and device I/O's
    \Process(_Total)\IO Write Operations/sec
        shows the rate at which a process issues write I/O operations. This counter includes all I/O activity generated by the process, including file, network, and device I/O's
    \Process(_Total)\IO Read Bytes/sec
        shows the rate at which a process reads bytes in I/O operations. This counter includes all I/O activity generated by the process, such as file, network, and device I/O.
    \Process(_Total)\IO Write Bytes/sec
        shows the rate at which a process writes bytes in I/O operations. This counter includes all I/O activity generated by the process, such as file, network, and device I/O.
</code></pre> <p><br></p> </li> <li> <p>From a command prompt session in "Administrator Mode" on the server you would like to collect data on, execute the following command:</p> </li> <li> <p>manageSQLServerPerfmonDataset.bat The following parameters can be specified:</p> </li> <li>-operation ** Required (create, start, stop, delete, collect, createemptyfile, help)</li> <li>-instanceType ** Required (default, named)</li> <li>-namedInstanceName ** Required if instanceType is "named" (should be the instance name without the server name)</li> <li>-sampleDuration ** The number of intervals that perfmon sample will run defaults to 1152 (10 minute samples for 8 days)</li> <li>-sampleInterval ** The interval that perfmon sample will run defaults to 600 (every 10 minutes)</li> </ul> <p>To create and start the perfmon collection:</p> <pre><code>    For a default instance:
        manageSQLServerPerfmonDataset.bat -operation create -instanceType default -sampleDuration [number of intervals to sample] -sampleInterval [frequency of sample intervals in seconds]

    For a named instance:
        manageSQLServerPerfmonDataset.bat -operation create -instanceType named -namedInstanceName [instance name] -sampleDuration [number of intervals to sample] -sampleInterval [frequency of sample intervals in seconds]
</code></pre> <p>The script will create a permon data set that will collect the above metrics at a 10 minute intervals for 8 days. The dataset will automatically stop after 8 days of collection. To get the most accurate statistics, it would be good to have this collection run over the busiest time for the server.</p> <p><br></p> <h4 id=perform-collection>Perform Collection</h4> <ul> <li>When the perfmon dataset completes or if you would like to execute the collection sooner, execute the following command from a command prompt session in "Administrator Mode" on the server you would like to collect data on and return the subsequent .zip file to Google.</li> <li> <p>The collection can also be run for all user databases or a single user database. See the below examples for each scenario <br></p> </li> <li> <p>runAssessment.bat The following parameters can be specified:</p> </li> <li>-serverName **Required</li> <li>-port **Optional (Defaults to 1433)</li> <li>-database **Optional (Defaults to all user databases)</li> <li>-collectionUserName **Required</li> <li>-collectionUserPass **Required</li> <li>-ignorePerfmon **Optional (Defaults to "false" / Set to "true" to ignore perfmon collection)</li> <li>-manualUniqueId **Optional (Defaults to "NA" - Gives the ability the user to tag their collection with a unique name)</li> <li>-collectVMSpecs **Optional switch. See <a href=#collectvmspecs>below</a>.</li> <li>-outputDirectory **Optional (write the final zip file to another location - must be escaped properly if spaces are in the directory name)</li> </ul> <p>To Execute the Collection:</p> <pre><code>  For a default instance (all databases):
    runAssessment.bat -serverName [servername] -port [port number] -collectionUserName [collection user name] -collectionUserPass [collection user password] -manualUniqueId [string]

    Example (default port): runAssessment.bat -serverName MS-SERVER1 -collectionUserName sa -collectionUserPass password123 -manualUniqueId [string]
    Example (custom port): runAssessment.bat -serverName MS-SERVER1 -port 1435 -collectionUserName sa -collectionUserPass password123 -manualUniqueId [string]

  For a default instance (single database):
    runAssessment.bat -serverName [servername] -port [port number] -database [single database name] -collectionUserName [collection user name] -collectionUserPass [collection user password] -manualUniqueId [string]

    Example (default port): runAssessment.bat -serverName MS-SERVER1 -database AdventureWorks2019 -collectionUserName sa -collectionUserPass password123 -manualUniqueId [string]
    Example (custom port): runAssessment.bat -serverName MS-SERVER1 -port 1435 -database AdventureWorks2019 -collectionUserName sa -collectionUserPass password123 -manualUniqueId [string]

  For a named instance (all databases):
    runAssessment.bat -serverName [servername\instanceName] -port [port number] -collectionUserName [collection user name] -collectionUserPass [collection user password] -manualUniqueId [string]

    Example (default port): runAssessment.bat -serverName MS-SERVER1/SQL2019 -collectionUserName sa -collectionUserPass password123 -manualUniqueId [string]
    Example (custom port): runAssessment.bat -serverName MS-SERVER1 -port 1435 -collectionUserName sa -collectionUserPass password123 -manualUniqueId [string]

  For a named instance (single database):
    runAssessment.bat -serverName [servername\instanceName] -port [port number] -database [single database name] -collectionUserName [collection user name] -collectionUserPass [collection user password] -manualUniqueId [string]

    Example (default port): runAssessment.bat -serverName MS-SERVER1/SQL2019 -database AdventureWorks2019 -collectionUserName sa -collectionUserPass password123 -manualUniqueId [string]
    Example (custom port): runAssessment.bat -serverName MS-SERVER1 -port 1437 -database AdventureWorks2019 -collectionUserName sa -collectionUserPass password123 -manualUniqueId [string]

  For Azure SQL Database (Ignore Perfmon Collection):
    runAssessment.bat -serverName [servername] -port [port number] -database [database name] -collectionUserName [collection user name] -collectionUserPass [collection user password] -ignorePerfmon true -manualUniqueId [string]

    Example (default port): runAssessment.bat -serverName MS-SERVER1 -database AdventureWorks2019 -collectionUserName sa -collectionUserPass password123 -ignorePerfmon true -manualUniqueId [string]
    Example (custom port): runAssessment.bat -serverName MS-SERVER1 -port 1435 -database AdventureWorks2019 -collectionUserName sa -collectionUserPass password123 -ignorePerfmon true -manualUniqueId [string]
    Example (default port / all databases): runAssessment.bat -serverName MS-SERVER1 -collectionUserName sa -collectionUserPass password123 -ignorePerfmon true -manualUniqueId [string]
    Example (custom port / all databases): runAssessment.bat -serverName MS-SERVER1 -port 1435 -collectionUserName sa -collectionUserPass password123 -ignorePerfmon true -manualUniqueId [string]



    Notes:
      1. Google Database Migration Assessment Data Extractor extracts data for all user databases present in the instance
      2. Collection scripts should be executed from an "Administrator Mode" command prompt
      3. When using a port to connect only provide the local host name
      4. The manualUniqueId can be used to give the collection a unique identifier specified by the customer
</code></pre> <h5 id=collectvmspecs>CollectVMSpecs:</h5> <p>To provide rightsizing information the script attempts to connect to the host VM using the current users credentials and collect hardware specs (number of CPUs/amount of memory).</p> <p>If the current user does not have sufficient permissions, it will skip this step. To manually input the correct credentials instead when this occurs, specify the <code>-collectVMSpecs</code> switch.</p> <p>This is recommended if you plan to upload the results to the Migration Center.</p> <pre><code>    Example: runAssessment.bat -serverName MS-SERVER1 -collectionUserName sa -collectionUserPass password123 -manualUniqueId [string] -collectVMSpecs
</code></pre> <hr> <h2 id=return-results>Return Results</h2> <ul> <li>An archive of the extracted results will be created in the directory collector/output.</li> <li>The full path and file name will be displayed on completion.</li> <li>Return the listed file to Google for processing</li> </ul> <p>!!! IMPORTANT Do not modify the name or the contents of the zip file without consultation from Google.</p> <h2 id=digitially-signing-powershell-scripts-optional-only-if-necessary>Digitially Signing Powershell Scripts (Optional / Only if Necessary)</h2> <p>Occasionally, organizational security policies require that Powershell scripts be digitally signed before they can be executed. Google will not provide a certificate to do this, however, the customer can create a self-signed certificate and then sign the scripts on their own using the following steps:</p> <pre><code>- Create directory to store the certificates
    - $PSScriptRoot\_Certs\

- Assign directories to variables
    - $certExport = "C:\$PSScriptRoot\_Certs\"
    - $ScriptRepo = "C:\$PSScriptRoot"

- Create variable params with relevant information to create the self signed certificate
    $params = @{
        Subject = 'Google DMA Self Signed PS Code Signing'
        DnsName = 'Self@google.com'
        FriendlyName = 'Google DMA Self Signed PS Code Signing'
        NotAfter = (Get-Date).AddYears(5)
        Type = 'CodeSigning'
        CertStoreLocation = 'cert:\CurrentUser\My'
        KeyUsage = 'DigitalSignature'
        KeyAlgorithm = 'RSA'
        KeyLength = 2048
        HashAlgorithm = 'sha256'
        }

- Create a new self-signed certificate based on the above parameters and send the details to 'newCodeSigningCert' variable for reference later.
    - New-SelfSignedCertificate @params -OutVariable newCodeSigningCert

- Export the public key to the file system.
    - Export-Certificate -Cert "cert:\CurrentUser\My\$($newCodeSigningCert.Thumbprint)" -FilePath "$($certExport)\CodeSigning.cer"

- Re-import certificate into Trusted Root otherwise it's not possible to validate any signed scripts.
    - Import-Certificate -FilePath "$($certExport)\CodeSigning.cer" -Cert Cert:\LocalMachine\root

- Sign all DMA Scripts
    - Set-AuthenticodeSignature $ScriptRepo\instanceReview.ps1 -Certificate (Get-ChildItem "cert:\CurrentUser\My\$($newCodeSigningCert.Thumbprint)" -CodeSigningCert)
    - Set-AuthenticodeSignature $ScriptRepo\createUserWithSQLAuth.ps1 -Certificate (Get-ChildItem "cert:\CurrentUser\My\$($newCodeSigningCert.Thumbprint)" -CodeSigningCert)
    - Set-AuthenticodeSignature $ScriptRepo\createUserWithWindowsAuth.ps1 -Certificate (Get-ChildItem "cert:\CurrentUser\My\$($newCodeSigningCert.Thumbprint)" -CodeSigningCert)
    - Set-AuthenticodeSignature $ScriptRepo\dmaCollectorCommonFunctions.psm1 -Certificate (Get-ChildItem "cert:\CurrentUser\My\$($newCodeSigningCert.Thumbprint)" -CodeSigningCert)
    - Set-AuthenticodeSignature $ScriptRepo\dmaSQLServerCorrectPerfmonDataset.ps1 -Certificate (Get-ChildItem "cert:\CurrentUser\My\$($newCodeSigningCert.Thumbprint)" -CodeSigningCert)
    - Set-AuthenticodeSignature $ScriptRepo\dmaSQLServerHWSpecs.ps1 -Certificate (Get-ChildItem "cert:\CurrentUser\My\$($newCodeSigningCert.Thumbprint)" -CodeSigningCert)
    - Set-AuthenticodeSignature $ScriptRepo\dmaSQLServerPerfmonDataset.ps1 -Certificate (Get-ChildItem "cert:\CurrentUser\My\$($newCodeSigningCert.Thumbprint)" -CodeSigningCert)
</code></pre> <h2 id=license>License</h2> <p>Copyright 2025 Google LLC</p> <p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p> <p>https://www.apache.org/licenses/LICENSE-2.0</p> <p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../../assets/javascripts/bundle.c8b220af.min.js></script> </body> </html>